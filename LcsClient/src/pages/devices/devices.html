<div class="container-fluid">
  <h3 style="margin-top:20px;">{{$t("labels.devices")}}</h3>
  <div class="row">
    <div class="col-12">
      <div class="status_legend">
        <div class="status_legend">
          {{$t("labels.deviceStatusLegend")}}
          <div class="status_legend"><span>{{$t("labels.deviceLoaded")}}</span><span class="icon icon-lamp-normal"></span></div>
          <div class="status_legend"><span>{{$t("labels.deviceNew")}}</span><span class="icon icon-lamp-new"></span></div>
          <div class="status_legend"><span>{{$t("labels.deviceLoading")}}</span><span class="icon icon-lamp-loading"></span></div>
          <div class="status_legend"><span>{{$t("labels.deviceWarning")}}</span><span class="icon icon-lamp-warning"></span></div>
          <div class="status_legend"><span>{{$t("labels.deviceLost")}}</span><span class="icon icon-lamp-lost"></span></div>
          <div class="status_legend" v-if="discovering"><span class="discoveryOn">{{ $t("labels.deviceScanFlagTrue") }}</span></div>
          <div class="status_legend" v-else><span class="discoveryOff">{{ $t("labels.deviceScanFlagfalse") }}</span></div>
          <div class="status_legend">
                          <span>
                              <Button icon="pi pi-check" @click="startStopDiscovery" :class="discovering ? 'btn btn-success' : 'btn btn-danger'">
                                  <i class="fa fa-check" aria-hidden="true"></i> &nbsp; {{$t('labels.deviceStartStopScanButton')}}
                              </Button>
                          </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div :key="polling" class="col-11">
      <div v-if="treeView">
        <Tree-table :value="toTreeTable" selectionMode="single" :expandedKeys="expandedKeys"
                    :filters="filters" @nodeSelect="onNodeSelect" :scrollable="true"
                    scrollHeight="70vh">
          <template #header>
            <div style="display:flex;">
              <div class="text-left" style="margin-right:42%;">
                <span class="icon icon-table_rows-switch" @click="toggleViewToTable"></span>
                <span class="icon icon-account_tree-switch" @click="toggleViewToTree"></span>
              </div>
              <div class="text-right" style="margin-left:39%;">
                <div class="p-input-icon-left">
                  <i class="pi pi-search"></i>
                  <InputText v-model="filters['global']" placeholder="Global Search" size="50" />
                </div>
              </div>
            </div>
          </template>
          <Column field="DeviceName" header="" :expander="true" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t('labels.deviceName')}}</span>
            </template>
          </Column>
          <Column field="Label" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t('labels.deviceLabel')}}</span>
            </template>
          </Column>
          <Column field="DeviceStatus" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t('labels.deviceStatus')}}</span>
            </template>
            <template #body="slotProps">
              <span :class="iconStatusSelector(slotProps.node.data.DeviceStatus)"></span>
            </template>
          </Column>
          <Column field="DmxAddress" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t('labels.deviceDmxStartAddress')}}</span>
            </template>
          </Column>
          <Column field="SoftwareVersionIdLabel" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t('labels.deviceFirmwareVersion')}}</span>
            </template>
          </Column>
          <Column field="DmxFootprint" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t('labels.deviceFootprint')}}</span>
            </template>
          </Column>
        </Tree-table>
      </div>
      <div v-if="!treeView">
        <DataTable :value="onlyRdmDevices" :paginator="true" :rows="10" :rowsPerPageOptions="[10,20,50]" :filters="filtersDT"
                   :globalFilterFields="columns" selectionMode="single" :scrollable="true" scrollHeight="75vh"
                   ><!--@rowSelect="onNodeSelect"-->
          <template #header>
            <div style="display:flex;">
              <div class="text-left" style="margin-right:42%;">
                <span class="icon icon-table_rows-switch" @click="toggleViewToTable"></span>
                <span class="icon icon-account_tree-switch" @click="toggleViewToTree"></span>
              </div>
              <div class="text-right" style="margin-left:39%;">
                <div class="p-input-icon-left">
                  <i class="pi pi-search"></i>
                  <InputText v-model="filtersDT['global'].value" placeholder="Global Search" size="50" />
                </div>
              </div>
            </div>
          </template>
          <Column field="DeviceName" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t("labels.deviceName")}}</span>
            </template>
          </Column>
          <Column field="Label" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t("labels.deviceLabel")}}</span>
            </template>
          </Column>
          <Column field="DmxAddress" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t("labels.deviceDmxStartAddress")}}</span>
            </template>
          </Column>
          <Column field="SoftwareVersionIdLabel" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t("labels.deviceFirmwareVersion")}}</span>
            </template>
          </Column>
          <Column field="DmxFootprint" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t("labels.deviceFootprint")}}</span>
            </template>
          </Column>
          <Column field="IpAddress" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t("labels.deviceIpAddress")}}</span>
            </template>
          </Column>
          <Column field="ParentPort" header="" sortable="true" headerClass="text-center" bodyClass="text-center">
            <template #header>
              <span>{{$t("labels.devicePortAddress")}}</span>
            </template>
          </Column>
        </DataTable>
      </div>
    </div>
  
    <ModalDialog header="" v-model:visible="displayDeviceInfo" :breakpoints="{'960px': '75vw', '640px': '90vw'}" :style="{width: '50vw'}">
      <template #header>
        <span>{{$t("labels.deviceInfoHeader")}} : {{this.selectedDevice.devName}}</span>
      </template>
      <device-info :device="selectedDevice"></device-info>
      <template #footer>
        <PrimButton label="Close" icon="pi pi-times" @click="closeDeviceInfo" class="p-button-text" />
      </template>
    </ModalDialog>
  </div>
</div>